install.packages('tidyverse')
install.packages("pomp",repos="https://kingaa.github.io/")
install.packages("mvtnorm")
install.packages("deSolve")
install.packages("coda")
install.packages("pomp",repos="https://kingaa.github.io/")
install.packages("pomp",repos="https://kingaa.github.io/")
source("https://kingaa.github.io/scripts/hello.R",echo=TRUE)
library(ggplot2)
install.packages(cowplot)
install.packages("cowplot")
library(ggplot2)
library(ggpubr)
library(ggpubr)
fig_dir = "../fig/"
main = 1 #main = 1: figure going to main text
opt_na=0
threshold = 3
if(opt_na == 0){
opt = "df_susc"
out = "real"
}else if (opt_na == 1){
opt = "df_susc_na_"
out = "real_na"
}
susc_theme = theme_bw() + theme(
axis.text.x = element_text(angle=290, vjust=0.7, hjust=0, size=7),
axis.text.y = element_text(size=8),
axis.title = element_text(size=9),
strip.text = element_text(size=8),
legend.title=element_text(size=8),
legend.text = element_text(size=8),
legend.key.size = unit(0.35, "cm"),
legend.margin = unit(-0.2, "cm"),
panel.grid = element_blank(),
strip.background = element_rect(fill = "white", colour = "white"))
titer_theme = theme_bw() + theme(
axis.text.x = element_text(size=8),
axis.text.y = element_text(size=8),
axis.title = element_text(size=10),
strip.text = element_text(size=7),
legend.title=element_text(size=8),
legend.text = element_text(size=8),
legend.key.size = unit(0.35, "cm"),
panel.grid = element_blank(),
strip.background = element_rect(fill = "white", colour = "white"))
if(opt_na==0){
susc_x_label = c("3C.3A", "3C.2A", "3C.2A1-1", "3C.2A1-2", "3C.2A1-3",
"3C.2A2-1", "3C.2A2-2", "3C.2A3")
susc_color_manual =  scale_color_manual(values = c("#FED976", "#FEB24C",
"#FC4E2A", "#E31A1C", "#B10026",
"#660000", "#160000", "grey70"),
breaks= factor(c(1,2,3,4,5,6,7,8)),
name = "Rank")
}else if (opt_na==1) {
susc_x_label = c("3C.2A (NA)", "3C.2A2-2 (NA)")
susc_color_manual = scale_color_manual(values = c("#FED976", "#FEB24C"),
limits= c(1,2),
name = "Rank")
}
rname = paste0("../result/", opt, threshold, "_0.rds")
df_susc = readRDS(rname)
df_susc$rank = as.integer( rank (-df_susc$num_sig, ties.method="min" ))
df_susc$rank = as.factor(df_susc$rank)
p_all = ggplot(df_susc) +
geom_point(aes(x=Clade, y=susceptibility, col=rank), size=2) +
geom_errorbar(aes(x=Clade, ymin=ci1, ymax=ci2, col=rank), size=1) +
ylab("Inferred relative susceptibility") +
xlab("") +
scale_x_discrete(labels = susc_x_label) +
scale_y_continuous(limits = c(0, 1)) +
susc_theme +
susc_color_manual
df_susc = readRDS(rname)
getwd()
setwd("~/Projects/population_immunity_predicting_flu/Analyses/frequency/src")
#if("dplyr" %in% (.packages())){
#  detach("package:dplyr", unload=TRUE)
#  detach("package:plyr", unload=TRUE)
#}
#library(plyr)
library(dplyr)
########################################################################################
data_assigned_NE_16 = read.csv("../data_clade_assigned/NE_clade_assigned_season_2016.csv")
data_assigned_NE_17 = read.csv("../data_clade_assigned/NE_clade_assigned_season_2017.csv")
data_assigned_US_16 = read.csv("../data_clade_assigned/US_clade_assigned_season_2016.csv")
data_assigned_US_17 = read.csv("../data_clade_assigned/US_clade_assigned_season_2017.csv")
data_assigned_NA_16 = read.csv("../data_clade_assigned/NA_clade_assigned_season_2016.csv")
data_assigned_NA_17 = read.csv("../data_clade_assigned/NA_clade_assigned_season_2017.csv")
make_frequency_table = function(data_assigned){
data_assigned = data_assigned[data_assigned$clade != "other", ]
data_assigned$clade = factor(data_assigned$clade,
levels = c("c3a", "c2a", "A1", "A1_2", "A1_3", "A2", "A2_2", "A3"))
freq_tb = data_assigned %>%
group_by(clade) %>%
summarise(count = length(clade))
freq_tb$freq = freq_tb$count / sum(freq_tb$count)
return(freq_tb)
}
freq_NE_16 = make_frequency_table(data_assigned_NE_16)
freq_NE_17 = make_frequency_table(data_assigned_NE_17)
freq_US_16 = make_frequency_table(data_assigned_US_16)
freq_US_17 = make_frequency_table(data_assigned_US_17)
freq_NA_16 = make_frequency_table(data_assigned_NA_16)
freq_NA_17 = make_frequency_table(data_assigned_NA_17)
freq_NE_16$season = "2016-17"
freq_US_16$season = "2016-17"
freq_NA_16$season = "2016-17"
freq_NE_17$season = "2017-18"
freq_US_17$season = "2017-18"
freq_NA_17$season = "2017-18"
freq_NE_16$region = "Northeastern US"
freq_US_16$region = "United States"
freq_NA_16$region = "North America"
freq_NE_17$region = "Northeastern US"
freq_US_17$region = "United States"
freq_NA_17$region = "North America"
#bind all together
tb = rbind(freq_NE_16, freq_NE_17,
freq_US_16, freq_US_17,
freq_NA_16, freq_NA_17)
tb$region = factor(tb$region, levels = c("North America", "United States", "Northeastern US"))
library(ggplot2)
susc_x_label = c("3C.3A", "3C.2A", "3C.2A1-1", "3C.2A1-2", "3C.2A1-3",
"3C.2A2-1", "3C.2A2-2", "3C.2A3")
p_freq = ggplot(tb, aes(x=clade, y=freq, fill=clade, linetype = factor(region))) +
geom_bar(color="black", width = 0.7, position=position_dodge(width=0.9), stat="identity") +
facet_wrap(~season, nrow=2) +
ylab("Frequency") +
xlab("") +
scale_x_discrete(labels=susc_x_label,
breaks = c("c3a", "c2a", "A1", "A1_2", "A1_3", "A2", "A2_2", "A3"),
limits = c("c3a", "c2a", "A1", "A1_2", "A1_3", "A2", "A2_2", "A3")) +
scale_fill_discrete(guide="none") +
scale_linetype_manual(name = "Region", values = c("solid", "dotted", "dashed")) +
guides(linetype=guide_legend(override.aes=list(fill=c(NA, NA, NA))) ) +
theme_bw() +
theme(axis.text.x = element_text(angle=310, hjust=0, vjust=1),
text=element_text(size=8),
axis.title = element_text(size=9),
axis.text = element_text(size=8),
panel.grid = element_blank(),
strip.background = element_rect(fill = "white", colour = "white"),
strip.text=element_text(size=8),
legend.position=c(0.8, 0.85),
legend.key.size=unit(0.7, "lines"))
p_freq
p_freq
tb
# Export to result folder
write.csv(tb, "../result/clade_frequencies.csv", row.names = F)
